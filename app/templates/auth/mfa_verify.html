{% extends "auth_base.html" %}

{% block title %}Verificação MFA{% endblock %}

{% block content %}

    <h4>Verificação em Duas Etapas</h4>
  </div>
  <div class="card-body">
    <p>Por favor, insira o código do seu app autenticador:</p>

    <form method="POST" action="{{ url_for('auth.mfa_verify') }}">
      {{ form.hidden_tag() }}
      <div class="mb-3">
        {{ form.mfa_code.label(class="form-label") }}
        {{ form.mfa_code(class="form-control") }}
        {% if form.mfa_code.errors %}
          <div class="invalid-feedback d-block">
            {% for error in form.mfa_code.errors %}
              {{ error }}
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="d-grid">
        {{ form.submit(class="btn btn-primary") }}
      </div>
    </form>

    {% if time_remaining > 0 %}
      <p class="mt-3">Tempo restante para expiração do código: <span id="countdown">{{ time_remaining|int }}</span> segundos</p>
      <script>
        const countdownElement = document.getElementById("countdown");
        if (countdownElement) {
          let timeRemaining = {{ time_remaining|int }};
          const countdown = setInterval(() => {
            if (timeRemaining > 0) {
              timeRemaining--;
              countdownElement.textContent = timeRemaining;
            } else {
              clearInterval(countdown);
            }
          }, 1000);
        }
      </script>
    {% else %}
      <p class="mt-3 text-danger">O código expirou.</p>
      <a href="{{ url_for('auth.resend_mfa_code') }}" class="btn btn-link mt-2">Reenviar código</a>
    {% endif %}

{% endblock %}
